# Интеграция с Google Calendar - Краткая инструкция

## Что было добавлено

✅ Кнопка "Подключить Google Calendar" на странице занятий (для преподавателей)
✅ Кнопка "Синхронизировать с Google Calendar" для экспорта расписания
✅ Кнопка "Отключить Google Calendar" для отключения интеграции
✅ Автоматическое обновление токенов доступа
✅ Поддержка одноразовых и повторяющихся занятий

## Быстрый старт

### 1. Получите учетные данные Google

1. Перейдите на https://console.cloud.google.com/
2. Создайте проект (или выберите существующий)
3. Включите **Google Calendar API**
4. Создайте **OAuth 2.0 Client ID** (тип: Web application)
5. Добавьте Redirect URI:
   - Для локальной разработки: `http://localhost:8000/google/calendar/callback`
   - Для продакшена: `https://ваш-домен.ru/google/calendar/callback`

### 2. Настройте .env

Добавьте в файл `.env`:

```env
GOOGLE_CLIENT_ID=ваш-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=ваш-client-secret
```

### 3. Готово!

Перезапустите приложение и используйте кнопки на странице занятий.

## Как использовать

### Для преподавателей:

1. **Подключение**: 
   - Откройте страницу "Занятия" в панели преподавателя
   - Нажмите кнопку "Подключить Google Calendar"
   - Авторизуйтесь через Google
   - После успешной авторизации вы вернетесь на страницу занятий

2. **Синхронизация**:
   - Нажмите кнопку "Синхронизировать с Google Calendar"
   - Все активные занятия будут экспортированы в ваш Google Calendar
   - Повторяющиеся занятия создаются с правилами повторения (RRULE)

3. **Отключение**:
   - Нажмите кнопку "Отключить Google Calendar"
   - Токены доступа будут удалены из базы данных

## Технические детали

### Что синхронизируется:

- **Название**: Название занятия (Room)
- **Описание**: Приветственное сообщение
- **Место**: "Online (BigBlueButton)"
- **Время**: Дата и время начала + продолжительность
- **Повторение**: Для повторяющихся занятий (daily, weekly, monthly)

### Безопасность:

- Токены доступа хранятся в зашифрованном виде в базе данных
- Refresh token используется для автоматического обновления доступа
- Каждый пользователь имеет свои собственные токены

### Файлы:

- **Контроллер**: `app/Http/Controllers/GoogleCalendarController.php`
- **Маршруты**: `routes/web.php` (секция Google Calendar)
- **Миграция**: `database/migrations/2025_12_19_174500_add_google_calendar_fields_to_users_table.php`
- **Модель User**: Добавлены поля для токенов

## Troubleshooting

**Ошибка "Invalid credentials"**
- Проверьте GOOGLE_CLIENT_ID и GOOGLE_CLIENT_SECRET в .env

**Ошибка "Redirect URI mismatch"**
- Убедитесь, что redirect URI в Google Console совпадает с вашим доменом

**Токен истек**
- Система автоматически обновит токен при следующей синхронизации
- Если не помогает, переподключите Google Calendar

## Дальнейшее развитие

Возможные улучшения:

- [ ] Автоматическая синхронизация при создании/изменении расписания (через Events/Observers)
- [ ] Удаление событий из Google Calendar при удалении занятия
- [ ] Обновление событий при изменении расписания
- [ ] Выбор календаря (не только primary)
- [ ] Добавление ссылки на BigBlueButton в описание события
